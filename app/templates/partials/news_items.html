{% if recent_activities %}
    {% for activity in recent_activities %}
        <div class="news-item">
            <div class="news-item-avatar">
                <img src="{{ url_for('static', filename='profile_pics/' + activity.user_activity.profile_image) }}" alt="Avatar {{ activity.user_activity.username }}">
            </div>
            <div class="news-item-content">
                <p class="mb-1">
                    <strong>{{ activity.user_activity.username }}</strong> ha appena completato un'attività:
                    "{{ activity.activity_type }} di {{ "%.2f"|format(activity.distance) }} km su percorso '{{ activity.route_activity.name }}'." 
                    <a href="{{ url_for('main.activity_detail', activity_id=activity.id) }}" class="text-primary">Vedi Dettagli</a>
                </p>
                <div class="text-muted small">Pubblicato il {{ activity.created_at.strftime('%d/%m/%Y alle %H:%M') }}</div>
            </div>
        </div>
    {% endfor %}
{% endif %}

{% if active_challenges %}
    {% for challenge in active_challenges %}
        <div class="news-item">
            <div class="news-item-content">
                <p class="mb-1">
                    È stata lanciata una nuova sfida:
                    "<strong>{{ challenge.name }}</strong>" sul percorso '{{ challenge.route_info.name }}'. La sfida terminerà il {{ challenge.end_date.strftime('%d/%m/%Y') }}.
                    <a href="{{ url_for('main.challenge_detail', challenge_id=challenge.id) }}" class="text-primary">Partecipa o Visualizza</a>
                </p>
                <div class="text-muted small">Creata il {{ challenge.created_at.strftime('%d/%m/%Y alle %H:%M') }}</div>
            </div>
        </div>
    {% endfor %}
{% endif %}

{% if community_posts %}
    {% for post in community_posts %}
        <div class="news-item">
            <div class="news-item-avatar">
                <img src="{{ url_for('static', filename='profile_pics/' + post.user.profile_image) }}" alt="Avatar {{ post.user.username }}">
            </div>
            <div class="news-item-content">
                <p class="mb-1">
                    <strong>{{ post.user.username }}</strong> ha pubblicato:
                    {{ post.content | safe }}
                    {% if post.image_url %}
                        <img src="{{ url_for('static', filename='posts_images/' + post.image_url) }}" class="img-fluid rounded mt-2" alt="Immagine Post">
                    {% endif %}
                    {% if post.post_type == 'link' and post.content %}
                        <a href="{{ post.content }}" class="text-primary" target="_blank">Visita il Link</a>
                    {% endif %}
                </p>
                <div class="text-muted small">Pubblicato il {{ post.created_at.strftime('%d/%m/%Y alle %H:%M') }}</div>
            </div>
        </div>
    {% endfor %}
{% endif %}

{% if not recent_activities and not active_challenges and not community_posts %}
    <p class="text-center text-muted">Nessun aggiornamento dalla community al momento.</p>
{% endif %}
