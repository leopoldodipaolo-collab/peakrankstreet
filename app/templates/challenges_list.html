{% extends "base.html" %}
{% from 'partials/_challenge_macros.html' import render_challenge_item %} {# Useremo una macro per non ripetere il codice #}

{% block title %}Le Tue Sfide{% endblock %}

{% block content %}
<div class="container my-5 pt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold mb-0"><i class="bi bi-bullseye me-2"></i>Dashboard Sfide</h1>
        <a href="{{ url_for('main.create_challenge') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i> Crea Nuova Sfida
        </a>
    </div>

    <!-- SEZIONE PRIORITARIA: INVITI IN SOSPESO -->
    {% if invited_challenges %}
    <div class="card shadow-sm mb-5 border-warning">
        <div class="card-header bg-warning text-dark">
            <h4 class="mb-0 h5"><i class="bi bi-bell-fill me-2"></i>Inviti in Sospeso ({{ invited_challenges|length }})</h4>
        </div>
        <div class="list-group list-group-flush">
            {% for challenge in invited_challenges %}
                {{ render_challenge_item(challenge, now, current_user, invited_challenges) }}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- NAVIGAZIONE A SCHEDE PER LE ALTRE SEZIONI -->
    <ul class="nav nav-pills nav-fill mb-4" id="challengesTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#active-challenges" type="button">Sfide Aperte</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#my-challenges" type="button">Le Mie Sfide Create</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#history" type="button">Storico</button>
        </li>
    </ul>

    <!-- CONTENUTO DELLE SCHEDE -->
    <div class="tab-content" id="challengesTabContent">
        <div class="tab-pane fade show active" id="active-challenges" role="tabpanel">
            {% if active_challenges %}
                <div class="list-group">{% for challenge in active_challenges %}{{ render_challenge_item(challenge, now, current_user) }}{% endfor %}</div>
            {% else %}
                <div class="text-center p-5 border rounded-3 bg-light"><h4>Nessuna sfida pubblica attiva al momento.</h4></div>
            {% endif %}
        </div>
        <div class="tab-pane fade" id="my-challenges" role="tabpanel">
            {% if my_challenges %}
                <div class="list-group">{% for challenge in my_challenges %}{{ render_challenge_item(challenge, now, current_user) }}{% endfor %}</div>
            {% else %}
                <div class="text-center p-5 border rounded-3 bg-light"><h4>Non hai ancora creato nessuna sfida.</h4></div>
            {% endif %}
        </div>
        <div class="tab-pane fade" id="history" role="tabpanel">
            {% if finished_challenges_pag.items %}
                <div class="list-group">{% for challenge in finished_challenges_pag.items %}{{ render_challenge_item(challenge, now, current_user) }}{% endfor %}</div>
                <!-- Paginazione per lo storico -->
                <nav class="mt-4">
                    ... (incolla qui il tuo codice di paginazione, usando `finished_challenges_pag` come variabile) ...
                </nav>
            {% else %}
                <div class="text-center p-5 border rounded-3 bg-light"><h4>Nessuna sfida nello storico.</h4></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}